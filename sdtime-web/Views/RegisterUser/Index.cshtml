@model sdtime.Security.ClaimsInfo

@{
    ViewBag.Title = "Register User";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="../../Scripts/jquery-1.8.2.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var local = {
        CheckCWIdentity: function () {
            var namq = $("#ConnectwiseID");
            var emq = $("#cwemail");
            var name = namq.val();
            var email = emq.val();

            $.ajax({
                type: "POST", url: "/Api/FindMember",
                accepts: "application/json",
                data: { Name: name, EmailAddress: email },
                success: function (data) {
                    //debugger;
                    var res = data[0].Value;

                    if (res == null) {
                        alert('#FAIL');
                        return;
                    }
                    //debugger;

                    namq.val(res.MemberID);
                    emq.val(res.EmailAddress);
                },
                error: function (a, b, c) {

                }
            });
        }
    };
    
</script>

<header class="clearfix">
	<h1><a href='@Url.Action("Index", "Home")'><img src='@Url.Content("~/Content/logo.png")' width="107" height="40" alt="SD Time" /></a></h1>
	
	<div class="filters clearfix">
		<select id="employee-filter" data-bind="options: members, optionsText: 'fullName', value: selectedMember, event: { change: addSelectedEmployee }"></select>
		<select id="client-filter" data-bind="options: clients, optionsText: 'clientName', value: selectedClient, event: { change: addSelectedClient }"></select>
	</div><!-- filters -->
	
	@{ Html.RenderPartial("LoginControl"); }
	
	<div class="filter-bar clearfix">
		<!-- ko foreach: selectedMembers -->
			<a class="filter-item" data-bind="text: fullName, event: { click: removeSelectedEmployee }" title="Remove this filter"></a>
		<!-- /ko -->
		<!-- ko foreach: selectedClients -->
			<a class="filter-item" data-bind="text: clientName, event: { click: removeSelectedClient }" title="Remove this filter"></a>			
		<!-- /ko -->
	</div><!-- filter-bar -->
	
	<div class="errordiv"></div>

</header>


<div style="position: relative; margin-left: 24px; margin-top: 68px;">

    <h2 class="IntroTitle">Please register (one time only)... </h2>

    <div class="display-field errormessage">
        @ViewBag.ErrorMessage
    </div>

    <fieldset>
        <legend>Login Info</legend>

        <div class="display-label">Provider Name</div>
        <div class="display-field">
            @Html.DisplayFor(model => model.IdentityProviderName)
        </div>
        <div class="display-field" style="display:none;">
            @Html.DisplayFor(model => model.ProviderKey)
        </div>
    
        @using(Html.BeginForm("Submit", "RegisterUser", FormMethod.Post)) {
        <div class="display-label">Email Address: </div>
        <div class="display-field">
            @Html.EditorFor(model => model.EmailAddress)
        </div>
        
        <div>
            <span><h3>Please link your identity to your Connectwise account.  Connect with your username or email address below.</h3></span>
        </div>

        <div class="display-label">Connectwise Search Fields: </div>
        <div class="display-label">Username: </div>
        <div class="display-field">
            @Html.EditorFor(model => model.ConnectwiseID)

        
        </div>
        <div class="display-label">Email Address: </div>
        <div class="display-field">
            <input type="text" name="cwemail" id="cwemail" />
            <input type="button" value="Connect" onclick="javascript:local.CheckCWIdentity();" />
        
        </div>    
        



        <div class="display-field">
            <input type="submit" value="Register" />
        </div>

        }
    </fieldset>

    </div>